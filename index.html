<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="author" content="Harshit Saxena">
		<title>Sample File Upload</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
  </head>
  <body>

    <div class="container">
      <div class="row">
        <div class="col-md-3 col-sm-3"></div>
        <div class="col-md-6 col-sm-6 col-xs-12">
          <h1>Sample Upload</h1>
          <hr>
          <form method="post" enctype="multipart/form-data">
            <input type="file" id="fileUpload" name="files" class="btn btn-default" />
            <br>
            <input type="submit" id="submitForm" name="submit" value="Submit" class="btn btn-primary" />
          </form>
          <hr>
          <div id="status">
            <h4>Status:</h4>
            <pre>$ Select a file to upload and hit submit.</pre>
          </div>
        </div>
        <div class="col-md-3 col-sm-3 col-xs-3"></div>
      </div>
    </div>
    <!--The below library(/socket.io/socket.io.js) will be generated by socket.io module of server -->
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript">
      var socket = io.connect("/");

      $(document).ready(function() {

        var files;
        $('input[type=file]').on('change', prepareUpload);
        $('form').on('submit', uploadFiles);

        // Grab the files and set them to our variable
        function prepareUpload(event) {
      		files = event.target.files;
          $("#status pre").append('\n$ File ready. Press submit.');
      	}

        // Catch the form submit and upload the files
        function uploadFiles(event) {

          event.stopPropagation();
          event.preventDefault();

          //Checking if the file is selected or not.
          if(typeof files === 'undefined') {
            $("#status pre").append('\n$ Please select a file and then hit enter.');
          } else {
            $("#status pre").append('\n$ Upload processing. Please Wait.');
          }

          // Create a formdata object and add the files
          var data = new FormData();
          $.each(files, function(key, value) {
            data.append("fileUploaded", value);
          });

          $.ajax({
            url: '//localhost:8080/upload_file',
            type: 'POST',
            data: data,
            cache: false,
            dataType: 'json',
            processData: false, // Don't process the files
            contentType: false,
            success: function(data, textStatus, jqXHR) {
              if(typeof data.error === 'undefined') {
                // Success so call function to send data to database
                //submitFormDataToDatabase(event, data);
                console.log(data);
                $("#status pre").append('\n$ Upload Successful.');
              } else {
                $("#status pre").append("\n$ Error: " + data.error);
              }
            },
            error: function(jqXHR, textStatus, errorThrown) {
              $("#status pre").append("\n$ Error: " + textStatus);
            }
          });
        }

        function submitFormDataToDatabase() {

        }

      });


    </script>
  </body>
</html>
